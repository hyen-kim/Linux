================================================================================

12주차

00. 개요
01. 사용자 계정 관련 파일
02. 사용자 계정 관리 명령
03. 그룹 관리 명령
04. 사용자 정보 관리 명령
05. 디스크 사용량(쿼터)설정

================================================================================

00. 개요

사용자/그룹
생성. 수정. 	사용자계정관리파일	사용자계정생성.수정.삭제	그룹 생성.수정.삭제 암호
  삭제

 사용자
정보 관리	UID와 EUID		사용자 확인 명령		root 권한 사용(sudo)		소유자.소유 그룹 변경


디스크		쿼터 설정준비		쿼터 설정			쿼터 확인
 쿼터







01. 사용자 계정 관리 파일

* 사용자 관리
- 리눅스 다중 사용자 시스템이므로 사용자를 구별하고 사용자에게 적절한 자원을 할당해주는 방법이 필요
- 사용자 계정은 사용자가 시스템에 접근할 수 있는 유일한 방법
- 시스템 관리자의 입장에서도 사용자의 접근 권한을 통제할 수 있는 중요한 수단



* /etc/passwd 파일
- 사용자 계정 정보가 저장된 기본 파일
- 한 행에 사용자 한 명에 대한 정보가 기록되며, 쌍점(:)으로 구분되는 일곱 개의 항목으로 구성

로그인ID : x : UID : GID : 설명 : 홈 디렉터리 : 로그인 셸

① 로그인 ID : 사용자 계정의 이름, 32자를 넘을 수 없으나 8자로 제한하는 것이 좋다
② x 	     : 초기 유닉스 시스템에서 사용자 암호를 저장하던 항목, 요즘은 /etc/shadow 파일에 별도로 보관
③ UID       : 사용자 ID 번호로 시스템이 사용자를 구별하기 위해 사용하는 번호
	- 0~999번과 65534번은 시스템 사용자를 위한 UID로 예약 (0:root, 1:bin, 2:daemon, 3:adm 등)
	- 일반 사용자들은 UID 1000번부터 할당
	- 로그인 ID가 다르더라도 UID가 같으면 리눅스 시스템은 같은 사용자로 판단, 
	  따라서 UID가 중복되지 않았는지 주의해야함
④ GID		: 그룹 ID, 시스템에 등록된 그룹에 대한 정보는 /etc/group 파일에 저장
⑤ 설명		: 사용자의 실명이나 부서명, 연락처 등 사용자에 대한 일반적인 정보가 기록
⑥ 홈 디렉터리	: 사용자 계정에 할당된 홈 디렉터리의 절대 경로를 기록
⑦ 로그인 셸	: 사용자의 로그인 셸을 지정, 페도라에서는 배시 셸을 기본 셸로 사용



* /etc/shadow 파일
- 사용자 암호에 관한 정보를 별도로 관리하는 파일
- root 계정으로만 내용을 볼 수 있음

로그인ID : 암호 : 최종 변경일 : MIN : MAX : MARNING : INACTIVE : EXPIPE : FIag

① 로그인 ID 		: 사용자 계정 이름
② 암호	     		: 실제 비밀번호가 암호화되어 저장
③ 최종변경일      	: 암호가 마지막으로 변경된 날짜를 지정, 1970년 1월 1일을 기준으로 날수를 기록
④ MIN			: MIN은 암호를 변경한 후 사용해야 하는 최소 기간
⑤ MAX			: 암호를 사용할 수 있는 최대 기간
⑥ WARNING		: 암호가 만료되기 전에 경고를 시작하는 날수
⑦ INACTIVE		: 암호가 만료된 후에도 이 항목에 지정한 날수 동안은 로그인이 가능
⑧ EXPIPE		: 사용자 계정이 만료되는 날
⑨ FIag			: 향후 사용할 목적으로 비워둔 항목



* /etc/login.defs 파일
- 사용자 계정의 설정과 관련된 기본 값을 정의



* /etc/group 파일
- 그룹에 대한 정보가 저장
- /etc/passwd 파일의 GID 항목에 지정된 그룹이 기본 그룹이며, 사용자가 속한 2차 그룹은 /etc/group 파일에 지정

그룹이름 : x : GID : 그룹 멤버

① 그룹이름	: 그룹의 이름
② x 		: 그룹의 암호를 저장하는 곳
	- 여기에 암호화된 그룹 암호를 저장하거나 /etc/gshadow 파일에 그룹 암호를 저장
③ GID		: 그룹을 식별하는 번호
④ 그룹 멤버	: 그룹에 속한 멤버들의 사용자 계정 이름이며 쉼표(,)로 사용자를 구별
	- 사용자의 2차 그룹



* /etc/gshadow 파일
- 그룹 암호가 저장
- 원래 유닉에는 없는 파일로 리눅스에서 별도로 만든 파일

그룹이름 : 그룹암호 : 관리자 : 그룹멤버

① 그룹이름	: 그룹의 이름
② 그룹암호 	: 암호환된 그룹의 암호
③ 관리자	: 그룹의 암호나 멤버를 바꿀 수 있는 사용자 계정으로 여러개 일 경우 쉼표(,)로 구분 
④ 그룹 멤버	: 그룹에 속한 멤버들의 사용자 계정 이름이며 쉼표(,)로 사용자를 구별
/etc/gshadow 파일의 예 : 아직 암호가 설정된 그룹이 없음






02. 사용자 계정 관리 명령

* 사용자 계정 생성하기
useradd
- 사용자 계정을 생성
- useradd [옵션] [로그인ID]
- -u uid : UID를 지정
- -o : UID의 중복을 허용
- -g gid : 기본 그룹의 GID를 지정
- -G gid : 2차 그룹의 GID를 지정
- -d 디렉터리명 : 홈 디렉터리를 지정
- -s 셸 : 기본 셸을 지정
- -c 설명 : 사용자의 이름 등 부가적인 설명을 지정
- -D : 기본값을 설정하거나 출력
- -e : 유효 기간 : EXPIRE 항목을 설정 (YYYY-MM-DD)
- -f 비활성 일수 : INACTIVE 항목을 설정
- -k 디렉터리 : 계정 생성 시 복사할 초기 파일이나 디렉터리를 설정해놓은 디렉터리를 지정
--> adduser 명령은 useradd에 대한 심벌릭 링크

< 옵션 없이 계정 생성하기 > 
useradd user2
- 사용자 계정을 추가했을 때 반드시 초기 암호를 바로 설정 : passwd user2 
- user1에서 user2 계정으로 전환 가능 : su -user2

< 기본 설정 값 확인하기 : -D 옵션 >
* useradd -D 명령으로 수정하는 것이 바람직 : -D 
  다음에 -b(HOME), -e(EXPIRE), -f(INACTIVE), -g(GID), -s(SHELL)을 지정하여 수정

- GROUP : 기본 등록 그룹의 GID로 100은 users 그룹
- HOME : 홈 디렉터리의 생성 위치
- INACTIVE : -1이면 INACTIVE 기능이 비활성화, 0이면 암호가 만료되자마자 바로 계정이 잠김
- EXPIRE : 계정 종료일을 지정
- SHELL : 기본 로그인 셸을 지정
- SKEL : 홈 디렉터리에 복사할 기본 환경 파일의 위치
- CREATE_MAIL_SPOOL : 메일 디렉터리의 생성 여부를 지정



* /etc/skel 디렉터리의 역할
- 사용자 계정의 홈 디렉터리에 공통으로 배포해야 할 파일은 /etc/skel 디렉터리에 파일을
  만들어 놓으면 사용자 계정 생성 시에 자동으로 복사

< 옵션을 지정하여 사용자 계정 생성하기 >
- 기본 로그인 셸을 본 셸로 지정하고 UID는 2000, GID는 1000, 2차 그룹은 3으로 지정
- -e와 -f 옵션을 사용하여 EXPIRE와 INACTIVE 값을 지정, -c 옵션으로 설명 부분도 값을 지정




* 사용자 계정 정보 수정하기 
- usermod 명령은 사용자 계정 정보를 수정할 때 사용
- UID, GID, 홈 디렉터리, 기본 셸, 설명, 로그인 ID 등 계정과 관련된 모든 정보를 수정 가능
- 패스워드 에이징 정보 중 INACTIVE와 EXPIRE 값 지정 가능
usermod
- 사용자 계정 정보를 수정
- usermod [옵션] [로그인 ID]

* 홈 디렉터리 변경하기 : -d 옵션
- user4 계정의 홈 디렉터리를 /home/user4에서 /home/user41로 변경
usermod -d /home/user41 user4

* 로그인 ID 변경하기 : -l 옵션
- 기존의 홈 디렉터리에 있던 파일들이 자동으로 옮겨지지는 않으므로 별도로 디렉터리를 생성하고
  이동해야함


* 패스워드 에이징 관련 명령
- 패스워드 에이징은 useradd, usermod, passwd, chage 명령으로 설정 가능
- chage는 패스워드 에이징을 관리하는 별도의 명령

* 사용자 계정 삭제하기 
userdel
- 사용자 계정을 삭제 
- userdel [옵션] [로그인 ID]
- -r : 홈 디렉터리를 삭제
- -f : 사용자가 로그인 중이여도 강제로 삭제 

* 사용자 계정만 삭제하기
- 사용자 계정이 삭제될 때 관련된 홈 디렉터리나 파일을 모두 삭제하는 것이 바람직

* 사용자 계정과 홈 디렉터리 삭제하기
- userdel 명령에서 -r 옵션을 지정하면 사용자 계정과 홈 디렉터리가 함께 삭제 




03. 그룹 관리 명령

* 새 그룹 생성하기 
groupadd
- 그룹을 생성
- groupadd [옵션] [그룹명]
- -g gid : 그룹의 GID를 지정
- -o : GID의 중복을 허용

* 옵션 없이 새 그룹 생성하기 
- 옵션이 없으면 GID를 가장 마지막 번호의 다음 번호로 자동 설정


* 그룹 정보 수정하기
groupmod 
- 그룹 정보를 수정
- -g gid : 그룹의 GID를 수정
- -o : GID의 중복을 허용
- -n 그룹명 : 그룹명을 다른 이름으로 변경


* 그룹 삭제하기
groupdel 
- 그룹을 삭제 
- groupdel [그룹명]


* 그룹 암호 설정하고 사용
gpasswd
- /etc/group, /etc/gshadow 파일을 관리
- gpasswd [옵션] [그룹명]
- -a 사용자 계정 : 사용자 계정을 그룹에 추가
- -d 사용자 계정 : 사용자 계정을 그룹에서 삭제
- -r : 그룹 암호를 삭제
--> 그룹에 멤버 추가 및 삭제, 암호 설정에 사용


* 소속 그룹 변경하기 : newgrp
- 소속 그룹을 다른 그룹으로 바꿈
- newgrp [그룹명]



